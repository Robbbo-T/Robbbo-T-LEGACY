{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "European Impact Ranking (RIE) Schema",
  "description": "Schema for calculating and validating RIE scores for MBA students",
  "type": "object",
  "required": ["student_id", "cohort", "assessment_period", "metrics", "evidence", "calculation"],
  "properties": {
    "utcs_mi": {
      "type": "string",
      "pattern": "^Est√°ndarUniversal:",
      "description": "UTCS-MI v5.0 compliant identifier"
    },
    "student_id": {
      "type": "string",
      "description": "Unique pseudonymized student identifier"
    },
    "cohort": {
      "type": "string",
      "pattern": "^\\d{4}-\\d{4}$",
      "description": "Academic year cohort (e.g., 2025-2026)"
    },
    "assessment_period": {
      "type": "object",
      "required": ["start_date", "end_date"],
      "properties": {
        "start_date": {
          "type": "string",
          "format": "date"
        },
        "end_date": {
          "type": "string", 
          "format": "date"
        }
      }
    },
    "metrics": {
      "type": "object",
      "required": ["M1", "M2", "M3", "M4", "M5", "M6"],
      "properties": {
        "M1": {
          "$ref": "#/definitions/metric",
          "description": "EU Proposals (weight: 0.30)"
        },
        "M2": {
          "$ref": "#/definitions/metric", 
          "description": "Open Science & Open Tech (weight: 0.20)"
        },
        "M3": {
          "$ref": "#/definitions/metric",
          "description": "Standardization/Regulation (weight: 0.15)"
        },
        "M4": {
          "$ref": "#/definitions/metric",
          "description": "Industry Impact (weight: 0.15)"
        },
        "M5": {
          "$ref": "#/definitions/metric",
          "description": "Evidence Quality (weight: 0.10)"
        },
        "M6": {
          "$ref": "#/definitions/metric",
          "description": "Ecosystem Impact (weight: 0.10)"
        }
      }
    },
    "evidence": {
      "type": "object",
      "required": ["det_references", "oracle_validations", "supporting_documents"],
      "properties": {
        "det_references": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^DET:CAB:MBA:.*:V\\d+$"
          },
          "description": "References to DET evidence packets"
        },
        "oracle_validations": {
          "type": "object",
          "properties": {
            "github": {
              "$ref": "#/definitions/oracle_validation"
            },
            "zenodo": {
              "$ref": "#/definitions/oracle_validation"
            },
            "cordis": {
              "$ref": "#/definitions/oracle_validation"
            },
            "standards_bodies": {
              "$ref": "#/definitions/oracle_validation"
            }
          }
        },
        "supporting_documents": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["type", "hash", "source"],
            "properties": {
              "type": {
                "type": "string",
                "enum": ["proposal", "publication", "patent", "standard_contribution", "loi", "pilot_agreement"]
              },
              "hash": {
                "type": "string",
                "pattern": "^[a-f0-9]{64}$",
                "description": "SHA256 hash for integrity verification"
              },
              "source": {
                "type": "string",
                "description": "Source system or repository"
              }
            }
          }
        }
      }
    },
    "calculation": {
      "type": "object",
      "required": ["raw_scores", "normalized_scores", "weighted_scores", "final_rie", "timestamp"],
      "properties": {
        "raw_scores": {
          "type": "object",
          "properties": {
            "M1": { "type": "number", "minimum": 0 },
            "M2": { "type": "number", "minimum": 0 },
            "M3": { "type": "number", "minimum": 0 },
            "M4": { "type": "number", "minimum": 0 },
            "M5": { "type": "number", "minimum": 0 },
            "M6": { "type": "number", "minimum": 0 }
          }
        },
        "normalized_scores": {
          "type": "object",
          "properties": {
            "M1": { "type": "number", "minimum": 0, "maximum": 1 },
            "M2": { "type": "number", "minimum": 0, "maximum": 1 },
            "M3": { "type": "number", "minimum": 0, "maximum": 1 },
            "M4": { "type": "number", "minimum": 0, "maximum": 1 },
            "M5": { "type": "number", "minimum": 0, "maximum": 1 },
            "M6": { "type": "number", "minimum": 0, "maximum": 1 }
          }
        },
        "weighted_scores": {
          "type": "object",
          "properties": {
            "M1": { "type": "number", "minimum": 0 },
            "M2": { "type": "number", "minimum": 0 },
            "M3": { "type": "number", "minimum": 0 },
            "M4": { "type": "number", "minimum": 0 },
            "M5": { "type": "number", "minimum": 0 },
            "M6": { "type": "number", "minimum": 0 }
          }
        },
        "final_rie": {
          "type": "number",
          "minimum": 0,
          "maximum": 1000,
          "description": "Final RIE score (sum of weighted normalized scores * 1000)"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time"
        }
      }
    }
  },
  "definitions": {
    "metric": {
      "type": "object",
      "required": ["raw_value", "multiplier", "evidence_items"],
      "properties": {
        "raw_value": {
          "type": "number",
          "minimum": 0,
          "description": "Base metric value before multipliers"
        },
        "multiplier": {
          "type": "number",
          "enum": [1.00, 1.20, 1.60, 2.00],
          "description": "State multiplier based on achievement status"
        },
        "adjusted_value": {
          "type": "number",
          "minimum": 0,
          "description": "Raw value * multiplier"
        },
        "evidence_items": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["id", "type", "status", "evidence_hash"],
            "properties": {
              "id": {
                "type": "string",
                "description": "Unique identifier for the evidence item"
              },
              "type": {
                "type": "string",
                "enum": ["proposal", "publication", "repo", "standard", "loi", "pilot", "workshop"]
              },
              "status": {
                "type": "string",
                "enum": ["submitted", "stage1_passed", "funded", "adopted", "delivered_on_time"]
              },
              "evidence_hash": {
                "type": "string",
                "pattern": "^[a-f0-9]{64}$"
              }
            }
          }
        }
      }
    },
    "oracle_validation": {
      "type": "object",
      "required": ["validated", "timestamp", "source"],
      "properties": {
        "validated": {
          "type": "boolean"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time"
        },
        "source": {
          "type": "string",
          "description": "Oracle endpoint or API used for validation"
        },
        "confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Confidence score of the validation"
        }
      }
    }
  }
}